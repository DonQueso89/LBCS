import*as e from"../utils/arr.min.js";import*as t from"../utils/domUtils.min.js";import s from"../utils/extend.min.js";import*as n from"../utils/is.min.js";import r from"../utils/pointerExtend.min.js";import*as i from"../utils/pointerUtils.min.js";export class FakeEvent{constructor(e){this.originalEvent=e,this.currentTarget=void 0,r(this,e)}preventOriginalDefault(){this.originalEvent.preventDefault()}stopPropagation(){this.originalEvent.stopPropagation()}stopImmediatePropagation(){this.originalEvent.stopImmediatePropagation()}}function o(e){if(!n.object(e))return{capture:!!e,passive:!1};const t=s({},e);return t.capture=!!e.capture,t.passive=!!e.passive,t}export default{id:"events",install(s){const r=[],a={},p=[],l={add:c,remove:u,addDelegate(t,s,n,r,i){const l=o(i);if(!a[n]){a[n]=[];for(const e of p)c(e,n,v),c(e,n,f,!0)}const u=a[n];let d=e.find(u,e=>e.selector===t&&e.context===s);d||(d={selector:t,context:s,listeners:[]},u.push(d)),d.listeners.push([r,l])},removeDelegate(e,t,s,n,r){const i=o(r),p=a[s];let l,c=!1;if(p)for(l=p.length-1;l>=0;l--){const r=p[l];if(r.selector===e&&r.context===t){const{listeners:e}=r;for(let r=e.length-1;r>=0;r--){const[o,{capture:a,passive:d}]=e[r];if(o===n&&a===i.capture&&d===i.passive){e.splice(r,1),e.length||(p.splice(l,1),u(t,s,v),u(t,s,f,!0)),c=!0;break}}if(c)break}}},delegateListener:v,delegateUseCapture:f,delegatedEvents:a,documents:p,targets:r,supportsOptions:!1,supportsPassive:!1};function c(t,s,n,i){const a=o(i);let p=e.find(r,e=>e.eventTarget===t);p||(p={eventTarget:t,events:{}},r.push(p)),p.events[s]||(p.events[s]=[]),t.addEventListener&&!e.contains(p.events[s],n)&&(t.addEventListener(s,n,l.supportsOptions?a:a.capture),p.events[s].push(n))}function u(t,s,n,i){const a=o(i),p=e.findIndex(r,e=>e.eventTarget===t),c=r[p];if(!c||!c.events)return;if("all"===s){for(s in c.events)c.events.hasOwnProperty(s)&&u(t,s,"all");return}let v=!1;const f=c.events[s];if(f){if("all"===n){for(let e=f.length-1;e>=0;e--)u(t,s,f[e],a);return}for(let e=0;e<f.length;e++)if(f[e]===n){t.removeEventListener(s,n,l.supportsOptions?a:a.capture),f.splice(e,1),0===f.length&&(delete c.events[s],v=!0);break}}v&&!Object.keys(c.events).length&&r.splice(p,1)}function v(e,s){const r=o(s),p=new FakeEvent(e),l=a[e.type],[c]=i.getEventTargets(e);let u=c;for(;n.element(u);){for(let e=0;e<l.length;e++){const s=l[e],{selector:n,context:i}=s;if(t.matchesSelector(u,n)&&t.nodeContains(i,c)&&t.nodeContains(i,u)){const{listeners:e}=s;p.currentTarget=u;for(const[t,{capture:s,passive:n}]of e)s===r.capture&&n===r.passive&&t(p)}}u=t.parentNode(u)}}function f(e){return v(e,!0)}return(s.document.createElement("div").addEventListener("test",null,{get capture(){return l.supportsOptions=!0},get passive(){return l.supportsPassive=!0}}),s.events=l,l)}};
//# sourceMappingURL=events.min.js.map